<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دعاء العهد</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            margin-bottom: 50px;
            background: url('bg1.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        .main-container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: rgba(183, 221, 226, 0.6);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .buttons-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px; 
            max-width: 1000px;
            margin: auto;
        }
        .redirect-button {
            background-color: #74bca3; 
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
        }
        .redirect-button[disabled] {
            background-color: gray; 
            cursor: not-allowed;
        }
        .prompt-container {
            display: none; 
            text-align: center;
            margin-top: 50px;
        }
        .password-container {
            display: none; 
            text-align: center;
            margin-top: 50px;
        }
        .prompt-button, .cancel-button, .password-button {
            background-color: #4CAF50; 
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            border-radius: 12px;
        }
        .cancel-button, .password-button.cancel {
            background-color: #f44336; 
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>اهلا بكم في حملة قراءة دعاء العهد</h1>
        <h3>اختر احد المربعات باللون الاخضر للمشاركة في قرائة الدعاء</h3>
        <div class="buttons-container" id="buttons-container"></div> 
        <div class="prompt-container" id="prompt-container">
            <h2>:رجاء ادخل اسمك</h2>
            <input type="text" id="nameInput" placeholder="Your name">
            <br><br>
            <button class="prompt-button" onclick="confirmName()">تاكيد</button>
            <button class="cancel-button" onclick="cancelName()">الغاء</button>
        </div>
        <div class="password-container" id="password-container">
            <h2>:رجاء ادخل كلمة المرور</h2>
            <input type="password" id="passwordInput" placeholder="Password">
            <br><br>
            <button class="password-button" onclick="validatePassword()">تاكيد</button>
            <button class="password-button cancel" onclick="cancelPassword()">الغاء</button>
        </div>
    </div>

    <!-- Include the Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const PASSWORD = 'yourpassword'; // Replace with your desired password
        let buttonIndex = null;

        function loadGoogleAPI() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                clientId: '1004619257079-iflqnqo9vemoefoitrungmevjfmbat0d.apps.googleusercontent.com', // Replace with your client ID
                scope: 'https://www.googleapis.com/auth/drive.file'
            }).then(() => {
                gapi.auth2.getAuthInstance().signIn().then(() => {
                    // Authenticated, proceed with your actions
                });
            });
        }

        function confirmName() {
            const name = document.getElementById('nameInput').value;
            if (name) {
                const fileContent = `Name: ${name}\nDate: ${new Date()}`;
                const file = new Blob([fileContent], { type: 'text/plain' });
                const metadata = {
                    'name': `name_${new Date().getTime()}.txt`,
                    'mimeType': 'text/plain'
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                gapi.client.drive.files.create({
                    resource: metadata,
                    media: {
                        mimeType: 'text/plain',
                        body: file
                    },
                    fields: 'id'
                }).then(function(response) {
                    console.log('File created with ID:', response.result.id);
                    alert('Name saved to Google Drive successfully.');
                    // Store the name and button index locally
                    localStorage.setItem('readerName', name);
                    localStorage.setItem('buttonIndex', buttonIndex);
                    // Redirect to story.html after successful save
                    window.location.href = "story.html";
                }).catch(function(error) {
                    console.error('Error creating file:', error);
                    alert('Failed to save name to Google Drive.');
                });
            } else {
                alert(".رجاء ادخل اسمك");
            }
        }

        function cancelName() {
            document.getElementById('prompt-container').style.display = 'none';
            document.getElementById('buttons-container').style.display = 'grid'; 
        }

        function validatePassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === PASSWORD) {
                const index = prompt('Enter the button number to remove name:');
                if (index && localStorage.getItem('button_' + index)) {
                    localStorage.removeItem('button_' + index);
                    alert('Name removed successfully.');
                } else {
                    alert('No name found for the given button number.');
                }
                cancelPassword();
            } else {
                alert('Incorrect password.');
            }
        }

        function cancelPassword() {
            document.getElementById('password-container').style.display = 'none';
            document.getElementById('buttons-container').style.display = 'grid';
        }

        function redirectToStory(index) {
            buttonIndex = index;
            document.getElementById('prompt-container').style.display = 'block';
            document.getElementById('buttons-container').style.display = 'none';
        }

        const container = document.getElementById('buttons-container');
        for (let i = 1; i <= 300; i++) {
            const button = document.createElement('button');
            button.className = 'redirect-button';
            button.textContent = 'دعاء ' + i;
            const storedName = localStorage.getItem('button_' + i);
            if (storedName) {
                button.innerHTML += `<br><small>${storedName}</small>`;
                button.disabled = true; 
            } else {
                button.onclick = () => redirectToStory(i);
            }
            container.appendChild(button);
        }

        window.onload = function() {
            loadGoogleAPI();
            const removeButton = document.createElement('button');
            removeButton.className = 'redirect-button';
            removeButton.textContent = 'Remove Name';
            removeButton.onclick = () => {
                document.getElementById('password-container').style.display = 'block';
                document.getElementById('buttons-container').style.display = 'none';
            };
            container.appendChild(removeButton);
        }
    </script>
</body>
</html>
